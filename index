<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Class Attendance</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    .controls { margin-bottom: 1rem; display: flex; align-items: center; gap: 1rem; }
    table { border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
    .present { background: #e0f7e9; cursor: pointer; }
    .absent { background: #fde0e0; cursor: pointer; }
    button { padding: 0.5rem 1rem; font-size: 1rem; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Class Attendance</h1>
  <div class="controls">
    <label for="attendance-date">Date:</label>
    <input type="date" id="attendance-date" />
    <button id="submit-btn">Submit Absences</button>
  </div>
  <table id="seat-plan">
    <tbody></tbody>
  </table>

  <script>
    // ====== CONFIG ======
    const webhookURL = 'https://YOUR_N8N_WEBHOOK_URL';
    const students = [
      'Alice','Bob','Charlie','Dana','Evan',
      'Fiona','George','Hannah','Ian','Jasmine',
      'Kyle','Luna','Maya','Nathan','Olivia',
      'Pete','Quinn','Rita','Sam','Tina'
    ];
    const cols = 5; // adjust seating columns
    // ====== END CONFIG ======

    // Build the seat plan
    const tbody = document.querySelector('#seat-plan tbody');
    for (let i = 0; i < Math.ceil(students.length / cols); i++) {
      const row = document.createElement('tr');
      for (let j = 0; j < cols; j++) {
        const idx = i * cols + j;
        const cell = document.createElement('td');
        if (students[idx]) {
          cell.textContent = students[idx];
          cell.dataset.name = students[idx];
          cell.classList.add('present');
        }
        row.appendChild(cell);
      }
      tbody.appendChild(row);
    }

    // Toggle present/absent on click
    tbody.addEventListener('click', (e) => {
      if (e.target.tagName !== 'TD' || !e.target.dataset.name) return;
      e.target.classList.toggle('present');
      e.target.classList.toggle('absent');
    });

    // Submit absences
    document.getElementById('submit-btn').addEventListener('click', async () => {
      const date = document.getElementById('attendance-date').value;
      if (!date) {
        alert('Please select a date first.');
        return;
      }
      const absentCells = Array.from(document.querySelectorAll('td.absent'));
      const absentNames = absentCells.map(td => td.dataset.name);
      const payload = { date, absences: absentNames };

      try {
        const res = await fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (res.ok) {
          alert('Absences submitted!');
        } else {
          alert('Error submitting data.');
        }
      } catch (err) {
        console.error(err);
        alert('Network error. Check console.');
      }
    });
  </script>
</body>
</html>
